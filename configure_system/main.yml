---
- hosts: localhost
  tasks:
    - name: Print external configuration values
      debug:
        msg: user = {{ user }}, repo = {{ repo }}
        # TODO: how to handle optional configurations? like awesome + xinitrc?
        # TODO: how to handle BIG template files like zsh/vimrc?
    - name: Show current hostname
      debug:
        msg: Running on {{ inventory_hostname }}
# Deploy all config links
    - name: Linking scripts folder
      file:
        src: "{{ repo }}/scripts"
        dest: ~/scripts
        owner: "{{ user }}"
        state: link
    - name: Linking vim folder
      file:
        src: "{{ repo }}/vim/vim_dir"
        dest: ~/.vim
        owner: "{{ user }}"
        state: link
    - name: Linking alacritty config
      file:
        src: "{{ repo }}/alacritty/alacritty.yml"
        dest: ~/.alacritty.yml
        owner: "{{ user }}"
        state: link
# Deploy copied configs
    - name: Deploying redshift config
      copy:
        src: "{{ repo }}/redshift/redshift.conf"
        dest: ~/.config/redshift.conf
        mode: 0644
    - name: Deploying vim config
      template:
        src: "{{ repo }}/vim/vimrc_main"
        dest: ~/.vimrc
      vars:
        llvm_version: 14
    - name: Installing vim plugins
      command: vi -c 'PlugInstall | qa'
    - name: Print external configuration values
      debug:
        msg: AOSF {{ ansible_os_family }}

# Handle OS specific tasks
    - include_tasks: gentoo.yml
      when: ansible_os_family == "Gentoo"
    - include_tasks: debian.yml
      when: ansible_os_family == "Debian"  # TODO: needs also ubuntu
